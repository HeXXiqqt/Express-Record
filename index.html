<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>产品图库系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
        body{background:linear-gradient(135deg,#1a2a6c,#2c3e50);color:#fff;min-height:100vh;padding:20px}
        .container{max-width:1400px;margin:0 auto}
        header{text-align:center;padding:20px 0;margin-bottom:30px;border-bottom:2px solid rgba(255,255,255,.1)}
        h1{font-size:2.8rem;margin-bottom:10px;background:linear-gradient(to right,#ffd700,#ff8c00);-webkit-background-clip:text;color:transparent;text-shadow:0 2px 4px rgba(0,0,0,.3)}
        .subtitle{font-size:1.2rem;opacity:.8;margin-bottom:20px}
        .upload-section{background:rgba(255,255,255,.1);border-radius:15px;padding:20px;margin-bottom:25px;text-align:center;backdrop-filter:blur(10px);box-shadow:0 5px 15px rgba(0,0,0,.2)}
        .upload-btn{position:relative;overflow:hidden;display:inline-block;cursor:pointer;padding:12px 30px;border-radius:50px;background:linear-gradient(45deg,#2193b0,#6dd5ed);color:#fff;font-weight:bold;transition:all .3s;box-shadow:0 4px 15px rgba(33,147,176,.4)}
        .upload-btn:hover{transform:translateY(-3px);box-shadow:0 7px 20px rgba(33,147,176,.6)}
        .upload-btn input{position:absolute;left:0;top:0;opacity:0;width:100%;height:100%;cursor:pointer}
        .file-name{font-size:.9rem;opacity:.8;margin-top:10px}
        .search-container{max-width:600px;margin:0 auto 30px;position:relative}
        .search-container input{width:100%;padding:14px 20px;border:none;border-radius:50px;background:rgba(255,255,255,.15);backdrop-filter:blur(10px);color:#fff;font-size:1.1rem;box-shadow:0 4px 15px rgba(0,0,0,.2)}
        .search-container input::placeholder{color:rgba(255,255,255,.7)}
        .search-container i{position:absolute;right:20px;top:50%;transform:translateY(-50%);color:rgba(255,255,255,.7)}
        .breadcrumb{display:flex;align-items:center;padding:15px 0;margin-bottom:20px;flex-wrap:wrap}
        .breadcrumb-item{display:flex;align-items:center;font-size:1rem;cursor:pointer;transition:all .3s;padding:8px 15px;border-radius:30px;margin:5px;background:rgba(255,255,255,.08)}
        .breadcrumb-item:hover{background:rgba(255,255,255,.15);transform:translateY(-2px)}
        .breadcrumb-item.active{background:linear-gradient(45deg,#ff8a00,#ff0080)}
        .breadcrumb i{margin:0 10px;opacity:.6}
        .content{display:grid;grid-template-columns:300px 1fr;gap:25px}
        .sidebar{background:rgba(30,30,46,.7);border-radius:20px;padding:25px;backdrop-filter:blur(10px);box-shadow:0 10px 30px rgba(0,0,0,.3);max-height:80vh;overflow-y:auto}
        .sidebar-title{font-size:1.4rem;margin-bottom:20px;padding-bottom:15px;border-bottom:1px solid rgba(255,255,255,.1);display:flex;align-items:center}
        .sidebar-title i{margin-right:10px;color:#ffd700}
        .category-list{list-style:none}
        .category-item{padding:14px 20px;border-radius:12px;margin-bottom:10px;cursor:pointer;transition:all .3s;display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,.05)}
        .category-item:hover{background:rgba(255,255,255,.1);transform:translateX(5px)}
        .category-item.active{background:linear-gradient(45deg,#2193b0,#6dd5ed);box-shadow:0 5px 15px rgba(33,147,176,.4)}
        .count{background:rgba(0,0,0,.3);padding:3px 10px;border-radius:20px;font-size:.9rem}
        .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:25px}
        .card{background:rgba(30,30,46,.7);border-radius:18px;overflow:hidden;transition:all .4s;box-shadow:0 10px 20px rgba(0,0,0,.2);backdrop-filter:blur(10px);height:100%;display:flex;flex-direction:column}
        .card:hover{transform:translateY(-10px);box-shadow:0 15px 30px rgba(0,0,0,.4)}
        .card-img{height:240px;overflow:hidden;position:relative}
        .card-img img{width:100%;height:100%;object-fit:cover;transition:transform .5s}
        .card:hover .card-img img{transform:scale(1.05)}
        .card-overlay{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(to top,rgba(0,0,0,.8),transparent);padding:20px}
        .card-title{font-size:1.3rem;margin-bottom:5px}
        .card-subtitle{font-size:.95rem;opacity:.8}
        .card-content{padding:20px;flex-grow:1;display:flex;flex-direction:column}
        .card-details{display:flex;justify-content:space-between;margin-top:15px;padding-top:15px;border-top:1px solid rgba(255,255,255,.1)}
        .detail-item{text-align:center}
        .detail-value{font-size:1.1rem;font-weight:bold;color:#ffd700}
        .detail-label{font-size:.85rem;opacity:.7;margin-top:5px}
        .card-footer{display:flex;justify-content:space-between;align-items:center;margin-top:auto;padding-top:15px}
        .btn{padding:10px 20px;border-radius:30px;background:linear-gradient(45deg,#ff8a00,#e52e71);color:#fff;border:none;cursor:pointer;font-weight:bold;transition:all .3s;display:inline-flex;align-items:center}
        .btn i{margin-right:8px}
        .btn:hover{transform:translateY(-3px);box-shadow:0 7px 15px rgba(229,46,113,.4)}
        .no-results{grid-column:1/-1;text-align:center;padding:50px;font-size:1.2rem;opacity:.7}
        .pagination{display:flex;justify-content:center;margin-top:30px;grid-column:1/-1}
        .page-btn{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 5px;background:rgba(255,255,255,.1);cursor:pointer;transition:all .3s}
        .page-btn:hover,.page-btn.active{background:linear-gradient(45deg,#ff8a00,#e52e71)}
        #lightbox{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center;z-index:1000}
        #lightbox img{max-width:90%;max-height:90%;border-radius:8px;box-shadow:0 0 40px rgba(255,255,255,.1)}
        #closeBox{position:absolute;top:30px;right:30px;color:#fff;font-size:3rem;cursor:pointer;transition:all .3s}
        #closeBox:hover{transform:scale(1.2)}
        .notification{position:fixed;top:20px;right:20px;padding:15px 25px;border-radius:10px;background:linear-gradient(45deg,#00c853,#64dd17);color:#fff;font-weight:bold;box-shadow:0 5px 15px rgba(0,0,0,.3);transform:translateX(200%);transition:transform .4s;z-index:2000}
        .notification.show{transform:translateX(0)}
        .notification.error{background:linear-gradient(45deg,#ff5252,#ff1744)}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-book"></i> 产品图库系统</h1>
            <p class="subtitle">上传产品数据文件，按品牌、系列浏览，支持搜索和分页</p>
            <div class="upload-section">
                <div class="upload-btn">
                    <i class="fas fa-upload"></i> 上传产品数据
                    <input type="file" id="file-input" accept=".txt">
                </div>
                <div class="file-name" id="file-name">未选择文件</div>
            </div>
            <div class="search-container">
                <input type="text" id="search-input" placeholder="搜索产品名称或颜色...">
                <i class="fas fa-search"></i>
            </div>
        </header>

        <div class="breadcrumb" id="breadcrumb">
            <div class="breadcrumb-item active" data-level="0">所有品牌</div>
        </div>

        <div class="content">
            <div class="sidebar">
                <h2 class="sidebar-title"><i class="fas fa-layer-group"></i> 分类列表</h2>
                <ul class="category-list" id="category-list"></ul>
            </div>
            <div class="gallery" id="gallery">
                <div class="no-results">
                    <i class="fas fa-cloud-upload-alt fa-3x"></i>
                    <p>欢迎使用产品图库系统</p>
                    <p>请上传产品数据文件开始使用</p>
                </div>
            </div>
        </div>

        <div class="pagination" id="pagination"></div>
    </div>

    <div id="lightbox">
        <span id="closeBox">×</span>
        <img id="lightImg" alt="">
    </div>

    <div class="notification" id="notification">操作成功</div>

    <script>
        let productIndex = {};
        const state = {
            currentLevel: 0,
            currentBrand: null,
            currentCategory: null,
            currentPage: 1,
            itemsPerPage: 8,
            totalItems: 0,
            totalPages: 1,
            searchTerm: '',
            dataLoaded: false
        };

        const breadcrumb = document.getElementById('breadcrumb');
        const categoryList = document.getElementById('category-list');
        const gallery = document.getElementById('gallery');
        const paginationEl = document.getElementById('pagination');
        const searchInput = document.getElementById('search-input');
        const lightbox = document.getElementById('lightbox');
        const lightImg = document.getElementById('lightImg');
        const closeBox = document.getElementById('closeBox');
        const fileInput = document.getElementById('file-input');
        const fileName = document.getElementById('file-name');
        const notification = document.getElementById('notification');

        function showNotification(message, isError = false) {
            notification.textContent = message;
            notification.classList.toggle('error', isError);
            notification.classList.add('show');
            setTimeout(() => notification.classList.remove('show'), 3000);
        }

        function parseCSV(csvData) {
            const lines = csvData.trim().split(/\r?\n/);
            const items = [];
            for (const line of lines) {
                if (!line.trim() || line.startsWith('#')) continue;
                const parts = line.split(',').map(s => s.trim());
                if (parts.length < 5) continue;
                const [url, brand, series, model, color] = parts;
                items.push({ url, brand, series, model, color });
            }
            return items;
        }

        function buildProductIndex(items) {
            const index = {};
            items.forEach(({ url, brand, series, model, color }) => {
                if (!index[brand]) index[brand] = {};
                if (!index[brand][series]) index[brand][series] = {};
                index[brand][series][model + color] = { url, model, color };
            });
            return index;
        }

        function getBrandProductCount(brand) {
            let count = 0;
            Object.keys(productIndex[brand] || {}).forEach(series => {
                count += Object.keys(productIndex[brand][series]).length;
            });
            return count;
        }

        function renderBreadcrumb() {
            breadcrumb.innerHTML = '';
            const home = document.createElement('div');
            home.className = 'breadcrumb-item' + (state.currentLevel === 0 ? ' active' : '');
            home.textContent = '所有品牌';
            home.dataset.level = '0';
            breadcrumb.appendChild(home);

            if (state.currentLevel >= 1 && state.currentBrand) {
                breadcrumb.appendChild(Object.assign(document.createElement('i'), { className: 'fas fa-chevron-right' }));
                const brandItem = document.createElement('div');
                brandItem.className = 'breadcrumb-item' + (state.currentLevel === 1 ? ' active' : '');
                brandItem.textContent = state.currentBrand;
                brandItem.dataset.level = '1';
                breadcrumb.appendChild(brandItem);
            }

            if (state.currentLevel >= 2 && state.currentCategory) {
                breadcrumb.appendChild(Object.assign(document.createElement('i'), { className: 'fas fa-chevron-right' }));
                const catItem = document.createElement('div');
                catItem.className = 'breadcrumb-item active';
                catItem.textContent = state.currentCategory;
                breadcrumb.appendChild(catItem);
            }
        }

        function renderCategories() {
            categoryList.innerHTML = '';
            if (!state.dataLoaded) return;
            if (state.currentLevel === 0) {
                Object.keys(productIndex).forEach(brand => {
                    const li = document.createElement('li');
                    li.className = 'category-item' + (state.currentBrand === brand ? ' active' : '');
                    li.innerHTML = `<span>${brand}</span><span class="count">${getBrandProductCount(brand)}</span>`;
                    li.onclick = () => {
                        state.currentBrand = brand;
                        state.currentLevel = 1;
                        state.currentPage = 1;
                        initApp();
                    };
                    categoryList.appendChild(li);
                });
            } else if (state.currentLevel === 1) {
                Object.keys(productIndex[state.currentBrand]).forEach(series => {
                    const li = document.createElement('li');
                    li.className = 'category-item' + (state.currentCategory === series ? ' active' : '');
                    li.innerHTML = `<span>${series}</span><span class="count">${Object.keys(productIndex[state.currentBrand][series]).length}</span>`;
                    li.onclick = () => {
                        state.currentCategory = series;
                        state.currentLevel = 2;
                        state.currentPage = 1;
                        initApp();
                    };
                    categoryList.appendChild(li);
                });
            }
        }

        function renderGallery() {
            if (!state.dataLoaded) return;
            gallery.innerHTML = '<div class="loading"><div class="spinner"></div><p>加载中...</p></div>';
            setTimeout(() => {
                let items = [];
                if (state.currentLevel === 0) {
                    items = Object.keys(productIndex).map(brand => ({ type: 'brand', name: brand, count: getBrandProductCount(brand) }));
                } else if (state.currentLevel === 1) {
                    items = Object.keys(productIndex[state.currentBrand]).map(series => ({ type: 'series', name: series, count: Object.keys(productIndex[state.currentBrand][series]).length }));
                } else if (state.currentLevel === 2) {
                    items = Object.values(productIndex[state.currentBrand][state.currentCategory]).map(p => ({ type: 'product', ...p }));
                    if (state.searchTerm) {
                        items = items.filter(p => p.model.includes(state.searchTerm) || p.color.includes(state.searchTerm));
                    }
                }

                state.totalItems = items.length;
                state.totalPages = Math.ceil(state.totalItems / state.itemsPerPage);
                const start = (state.currentPage - 1) * state.itemsPerPage;
                const currentItems = items.slice(start, start + state.itemsPerPage);

                gallery.innerHTML = '';
                if (currentItems.length === 0) {
                    gallery.innerHTML = `<div class="no-results"><i class="fas fa-search fa-2x"></i><p>未找到结果</p><p>请尝试其他关键词</p></div>`;
                    return;
                }

                currentItems.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'card';

                    let imgSrc = '';
                    if (item.type === 'brand') {
                        const seriesKeys = Object.keys(productIndex[item.name]);
                        if (seriesKeys.length) {
                            const firstSeries = seriesKeys[0];
                            const productKeys = Object.keys(productIndex[item.name][firstSeries]);
                            if (productKeys.length) imgSrc = productIndex[item.name][firstSeries][productKeys[0]].url;
                        }
                    } else if (item.type === 'series') {
                        const productKeys = Object.keys(productIndex[state.currentBrand][item.name]);
                        if (productKeys.length) imgSrc = productIndex[state.currentBrand][item.name][productKeys[0]].url;
                    } else {
                        imgSrc = item.url;
                    }

                    card.innerHTML = `
                        <div class="card-img">
                            <img src="${imgSrc}" alt="${item.name || item.model}" loading="lazy">
                            <div class="card-overlay">
                                <h3 class="card-title">${item.name || item.model}</h3>
                                <p class="card-subtitle">${item.type === 'product' ? item.color : ''}</p>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="card-details">
                                <div class="detail-item">
                                    <div class="detail-value">${item.count || item.color}</div>
                                    <div class="detail-label">${item.type === 'product' ? '颜色' : '数量'}</div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <button class="btn"><i class="fas fa-eye"></i> 查看</button>
                            </div>
                        </div>
                    `;

                    if (item.type === 'brand') {
                        card.onclick = () => {
                            state.currentBrand = item.name;
                            state.currentLevel = 1;
                            state.currentPage = 1;
                            initApp();
                        };
                    } else if (item.type === 'series') {
                        card.onclick = () => {
                            state.currentCategory = item.name;
                            state.currentLevel = 2;
                            state.currentPage = 1;
                            initApp();
                        };
                    } else {
                        card.onclick = () => {
                            lightImg.src = item.url;
                            lightbox.style.display = 'flex';
                        };
                    }

                    gallery.appendChild(card);
                });

                renderPagination();
            }, 300);
        }

        function renderPagination() {
            paginationEl.innerHTML = '';
            if (state.totalPages <= 1) return;
            const prev = document.createElement('div');
            prev.className = 'page-btn' + (state.currentPage === 1 ? ' disabled' : '');
            prev.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prev.onclick = () => {
                if (state.currentPage > 1) {
                    state.currentPage--;
                    renderGallery();
                }
            };
            paginationEl.appendChild(prev);

            for (let i = 1; i <= state.totalPages; i++) {
                const btn = document.createElement('div');
                btn.className = 'page-btn' + (i === state.currentPage ? ' active' : '');
                btn.textContent = i;
                btn.onclick = () => {
                    state.currentPage = i;
                    renderGallery();
                };
                paginationEl.appendChild(btn);
            }

            const next = document.createElement('div');
            next.className = 'page-btn' + (state.currentPage === state.totalPages ? ' disabled' : '');
            next.innerHTML = '<i class="fas fa-chevron-right"></i>';
            next.onclick = () => {
                if (state.currentPage < state.totalPages) {
                    state.currentPage++;
                    renderGallery();
                }
            };
            paginationEl.appendChild(next);
        }

        function initApp() {
            renderBreadcrumb();
            renderCategories();
            renderGallery();
        }

        fileInput.addEventListener('change', e => {
            const file = e.target.files[0];
            if (!file) return;
            fileName.textContent = file.name;
            const reader = new FileReader();
            reader.onload = () => {
                const items = parseCSV(reader.result);
                if (items.length === 0) {
                    showNotification('数据格式错误或为空', true);
                    return;
                }
                productIndex = buildProductIndex(items);
                state.dataLoaded = true;
                state.currentLevel = 0;
                state.currentBrand = null;
                state.currentCategory = null;
                state.currentPage = 1;
                initApp();
                showNotification(`成功加载 ${items.length} 条产品数据`);
            };
            reader.readAsText(file);
        });

        searchInput.addEventListener('input', () => {
            state.searchTerm = searchInput.value.trim();
            state.currentPage = 1;
            renderGallery();
        });

        closeBox.onclick = () => lightbox.style.display = 'none';

        breadcrumb.addEventListener('click', e => {
            const item = e.target.closest('.breadcrumb-item');
            if (!item) return;
            const level = parseInt(item.dataset.level ?? 0);
            if (level === 0) {
                state.currentLevel = 0;
                state.currentBrand = null;
                state.currentCategory = null;
                state.currentPage = 1;
                initApp();
            } else if (level === 1) {
                state.currentLevel = 1;
                state.currentCategory = null;
                state.currentPage = 1;
                initApp();
            }
        });

        initApp();
    </script>
</body>
</html>
